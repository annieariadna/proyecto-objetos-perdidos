{% extends 'base.html' %}
{% block title %}Inicio - Objetos Perdidos UTP{% endblock %}

{% block content %}
<script>
  window.currentUserId = {{ current_user.id | tojson }};
</script>

<h2 class="mb-4 text-center text-primary fw-bold">ðŸ”Ž Buscar Objetos Perdidos y Encontrados</h2>

<form method="get" class="row g-3 mb-4 justify-content-center">
  <div class="col-md-4">
    <input
      type="text"
      name="descripcion"
      class="form-control"
      placeholder="Buscar por nombre o descripciÃ³n"
      value="{{ request.args.get('descripcion', '') }}"
    />
  </div>

  <div class="col-md-3">
    <select name="ubicacion" class="form-select">
      <option value="">Todas las ubicaciones</option>
      {% for area in areas %}
      <option value="{{ area }}" {% if request.args.get('ubicacion') == area %}selected{% endif %}>
        {{ area }}
      </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-2">
    <select name="estado" class="form-select">
      <option value="">Todos</option>
      <option value="Perdido" {% if request.args.get('estado') == 'Perdido' %}selected{% endif %}>Perdidos</option>
      <option value="Encontrado" {% if request.args.get('estado') == 'Encontrado' %}selected{% endif %}>Encontrados</option>
    </select>
  </div>

  <div class="col-md-2">
    <input
      type="date"
      name="fecha"
      class="form-control"
      value="{{ request.args.get('fecha', '') }}"
    />
  </div>

  <div class="col-md-1 d-grid">
    <button type="submit" class="btn btn-primary">Buscar</button>
  </div>
</form>

{% if objetos %}
<div class="row row-cols-1 row-cols-md-3 g-4">
  {% for obj in objetos %}
  <div class="col">
    <div
      class="card h-100 shadow rounded-3"
      style="cursor: pointer; border-radius: 15px;"
      data-bs-toggle="modal"
      data-bs-target="#detalleModal"
      data-id="{{ obj.id }}"
      data-userid="{{ obj.user_id }}"
      data-nombre="{{ obj.nombre }}"
      data-estado="{{ obj.estado or 'Perdido' }}"
      data-descripcion="{{ obj.descripcion }}"
      data-area="{{ obj.area }}"
      data-fecha="{{ obj.fecha_encuentro.strftime('%d/%m/%Y') }}"
      data-persona="{{ obj.nombre_persona }}"
      data-contacto="{{ obj.contacto }}"
      data-foto="{{ url_for('static', filename='uploads/' ~ obj.foto) if obj.foto else 'https://via.placeholder.com/300x300?text=Sin+Foto' }}"
      role="button"
      tabindex="0"
      aria-label="Ver detalles de {{ obj.nombre }}"
    >
      {% if obj.foto %}
      <img
        src="{{ url_for('static', filename='uploads/' ~ obj.foto) }}"
        class="card-img-top rounded-top-3"
        alt="Foto {{ obj.nombre }}"
        style="height: 250px; object-fit: cover; border-radius: 15px 15px 0 0;"
      />
      {% else %}
      <img
        src="https://via.placeholder.com/300x250?text=Sin+Foto"
        class="card-img-top rounded-top-3"
        alt="Sin foto"
        style="height: 250px; object-fit: cover; border-radius: 15px 15px 0 0;"
      />
      {% endif %}
      <div class="card-body d-flex flex-column justify-content-between">
        <div>
          <h5 class="card-title text-primary fw-bold">{{ obj.nombre }}</h5>
          <p class="card-text text-secondary small">{{ obj.descripcion or 'Sin descripciÃ³n' }}</p>
          <p class="mb-1">
            <i class="bi bi-geo-alt-fill text-info"></i>
            <span class="fw-semibold">{{ obj.area }}</span>
          </p>
          <p class="mb-2">
            <i class="bi bi-calendar-event-fill text-muted"></i>
            <small>{{ obj.fecha_encuentro.strftime('%d/%m/%Y') }}</small>
          </p>
        </div>
        <p>
          <span
            class="badge rounded-pill bg-{{ 'success' if obj.estado == 'Encontrado' else 'warning' }} text-dark"
            style="font-size: 0.85rem;"
            >{{ obj.estado or 'Perdido' }}</span
          >
        </p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<p class="text-center text-muted fs-5 mt-5">No se encontraron objetos que coincidan.</p>
{% endif %}
{% endblock %}

